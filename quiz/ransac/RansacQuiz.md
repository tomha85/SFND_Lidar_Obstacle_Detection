# Implementing RANSAC

RANSAC stands fors Randomly Sample Consensus, and is a method for detecting outliers in data. RANSAC runs a for a max number of iterations, and returns the model with the best fit. Here we will do a quiz that has you implement RANSAC for fitting a line in 2D point data with outliers. The quiz is located in `src/quiz/ransac2d.cpp` and the function to fill out is `Ransac` which takes in arguments for a point cloud, max iterations to run, and distance tolerance. The point cloud is actually `pcl::PointXYZ` but the z component will be set to zero to make things easy to visualize. The image below shows how the data looks.

<img src="https://github.com/awbrown90/SensorFusionHighway/blob/master/media/ransac2d.png" width="700" height="400" />

The data was generated by creating a line with points slightly scattered, and then outliers were added by randomly placing points in the scene. We want to be able to identify which points belong to the line that was originally generated and which points are outliers. To do this you will randomly sample two points from the cloud and fit a line between the points. A helpful line equation for this problem can be seen below.

```
Ax + By + C = 0
for point1 (x1, y1), and point2 (x2, y2)
(y1  y2)x + (x2  x1)y + (x1y2  x2y1) = 0
```

After fitting the line you can then iterate through all the points and determine if they are inliers by measuring how far away the point is from the line. You can do this for each iteration keeping track of which fitted line had the highest number of inliers, the line with the most inliers will be the best model. The equation for calculating distance between a point and line is shown below. For further details see, https://brilliant.org/wiki/dot-product-distance-between-point-and-a-line/. 

```
line is Ax + By + C = 0
point (x,y)
d = |A*x+B*y+C|/sqrt(A^2+B^2)
```

Here is the results of doing RANSAC to fit a line from the data above. Inliers are green while outliers are red, the function had a max iteration size of 50, and a distance tolerance of 0.5. The max iteration size depends on the ratio of inliers to the total number of points. The more inliers our data contains the higher the probability of selecting inliers to fit the line to.

<img src="https://github.com/awbrown90/SensorFusionHighway/blob/master/media/ransac2dFitted.png" width="700" height="400" />

The method above was for fitting a line, you can do the same thing for fitting plane in a 3D point cloud by using the equation for a plane from three points, and the distance formula for a point to a plane.

```
plane is Ax + By + Cz + D = 0
for point1 (x1, y1, z1)
for point2 (x2, y2, z2)
for point3 (x3, y3, z3)

Use point1 as reference and define two vectors on the plane v1, and v2

vector v1 travels from point1 to point2
vector v2 travels from point1 to point3

v1 = < x2 - x1, y2 - y1, z2 - z1 >
v2 = < x3 - x1, y3 - y1, z3 - z1 >

Find normal vector of plane by taking cross product of v1 x v2.

v1 x v2 = <(y2-y1)(z3-z1)-(z2-z1)(y3-y1), (z2-z1)(x3-x1)-(x2-x1)(z3-z1), (x2-x1)(y3-y1)-(y2-y1)(x3-x1)>

To simplify notation we can write it in the form 
v1 x v2 = < i, j, k >

then ,

i(x-x1)+j(y-y1)+k(z-z1) = 0,
ix + jy + kz -( ix1 + jy1 + kz1 ) = 0

A = i
B = j
C = k
D = -( ix1 + jy1 + kz1 )
```

And the distance formula from a point to the plane is then,


```
plane is Ax + By + Cz + D = 0
point (x,y,z)
d = |A*x+B*y+C*z+D|/sqrt(A^2+B^2+C^2)
```

When implementing RANSAC try timing how long it takes to execute and compare its time to pcl's built in RANSAC functions.


